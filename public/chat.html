<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat â€“ Rylac App</title>
  <meta name="robots" content="noindex" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¬</text></svg>">
  <link rel="stylesheet" href="/css/chat.css">
</head>
<body>

<!-- Loading Screen -->
<div class="loading-screen" id="loading-screen">
  <div class="loading-logo">ğŸ’¬</div>
  <div class="loading-text">Rylac</div>
  <div class="loading-spinner"></div>
</div>

<!-- Context Menu -->
<div class="context-menu" id="context-menu">
  <div class="ctx-item" id="ctx-reply">â†©ï¸ Reply</div>
  <div class="ctx-item" id="ctx-react">ğŸ˜Š React</div>
  <div class="ctx-item" id="ctx-copy">ğŸ“‹ Copy Text</div>
  <div class="ctx-item danger" id="ctx-delete-me">ğŸ—‘ï¸ Delete for Me</div>
  <div class="ctx-item danger" id="ctx-delete-all" style="display:none">ğŸ—‘ï¸ Delete for Everyone</div>
</div>

<!-- React Picker (inline) -->
<div class="context-menu" id="react-menu" style="min-width:auto">
  <div style="display:flex; gap:0.2rem; padding:0.5rem;">
    <button class="emoji-btn-item" data-emoji="â¤ï¸">â¤ï¸</button>
    <button class="emoji-btn-item" data-emoji="ğŸ˜‚">ğŸ˜‚</button>
    <button class="emoji-btn-item" data-emoji="ğŸ˜®">ğŸ˜®</button>
    <button class="emoji-btn-item" data-emoji="ğŸ˜¢">ğŸ˜¢</button>
    <button class="emoji-btn-item" data-emoji="ğŸ‘">ğŸ‘</button>
    <button class="emoji-btn-item" data-emoji="ğŸ‘">ğŸ‘</button>
    <button class="emoji-btn-item" data-emoji="ğŸ”¥">ğŸ”¥</button>
  </div>
</div>

<!-- App Container -->
<div class="app-container" id="app-container" style="display:none">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <!-- Header -->
    <div class="sidebar-header">
      <div class="app-logo">
        <span class="logo-icon">ğŸ’¬</span>
        <span class="logo-text">Rylac</span>
      </div>
      <div class="header-actions">
        <button class="icon-btn" id="search-btn" title="Search users">ğŸ”</button>
        <button class="icon-btn" id="theme-btn" title="Toggle theme">ğŸŒ™</button>
        <button class="icon-btn" id="profile-btn" title="Your profile">ğŸ‘¤</button>
        <button class="icon-btn" id="logout-btn" title="Logout">ğŸšª</button>
      </div>
    </div>

    <!-- Search bar -->
    <div class="sidebar-search">
      <div class="search-input-wrap">
        <span class="search-icon">ğŸ”</span>
        <input type="text" class="search-input" id="contact-search" placeholder="Search contacts..." />
      </div>
    </div>

    <!-- Contacts -->
    <div class="contacts-list" id="contacts-list">
      <div class="empty-contacts">
        <span class="empty-icon">ğŸ’¬</span>
        <p>No conversations yet.<br>Search for users to start chatting!</p>
      </div>
    </div>

    <!-- Own Profile -->
    <div class="sidebar-profile" id="own-profile-bar">
      <div class="avatar" id="own-avatar"></div>
      <div>
        <div class="profile-name" id="own-name">Loading...</div>
        <div class="profile-status">ID: <span id="own-id">â€”</span></div>
      </div>
    </div>
  </aside>

  <!-- CHAT AREA -->
  <main class="chat-area" id="chat-area">
    <!-- Empty state -->
    <div class="chat-empty" id="chat-empty">
      <div class="empty-icon">ğŸ’¬</div>
      <h3>Select a conversation</h3>
      <p>Choose a contact or search for someone to chat with</p>
    </div>

    <!-- Active chat (hidden by default) -->
    <div id="chat-window" style="display:none; flex-direction:column; height:100%;">
      <!-- Chat Header -->
      <div class="chat-header">
        <button class="icon-btn back-btn" id="back-btn">â†</button>
        <div class="avatar" id="chat-avatar" onclick="openUserProfile()"></div>
        <div class="chat-user-info" onclick="openUserProfile()">
          <div class="chat-username" id="chat-username">Username</div>
          <div class="chat-status" id="chat-status">Loading...</div>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="pin-chat-btn" title="Pin Chat">ğŸ“Œ</button>
          <button class="icon-btn" id="block-user-btn" title="Block User">ğŸš«</button>
          <button class="icon-btn danger" id="clear-chat-btn" title="Clear Chat">ğŸ—‘ï¸</button>
          <button class="icon-btn" id="user-search-in-chat-btn" title="Search user" onclick="openUserProfile()">â„¹ï¸</button>
        </div>
      </div>

      <!-- Messages -->
      <div class="messages-container" id="messages-container"></div>

      <!-- GIF Picker -->
      <div class="gif-picker" id="gif-picker">
        <div class="gif-header" style="display:flex; justify-content:space-between; align-items:center; padding: 10px 15px; border-bottom: 1px solid var(--border);">
          <span style="font-weight:600;">Choose GIF</span>
          <button onclick="document.getElementById('gif-picker').classList.remove('show')" style="background:none; border:none; font-size:1.2rem; cursor:pointer; color:var(--text-muted);">âœ•</button>
        </div>
        <div class="gif-search-wrap">
          <input type="text" class="gif-search" id="gif-search" placeholder="Search GIFs..." />
        </div>
        <div class="gif-grid" id="gif-grid">
          <div class="gif-loading">Loading trending GIFs... ğŸ­</div>
        </div>
      </div>

      <!-- Emoji Picker -->
      <div class="emoji-picker" id="emoji-picker">
        <div class="emoji-header" style="display:flex; justify-content:space-between; align-items:center; padding: 10px 15px; border-bottom: 1px solid var(--border); margin-bottom: 10px;">
          <span style="font-weight:600;">Select Emoji</span>
          <button onclick="document.getElementById('emoji-picker').classList.remove('show')" style="background:none; border:none; font-size:1.2rem; cursor:pointer; color:var(--text-muted);">âœ•</button>
        </div>
        <div class="emoji-grid" id="emoji-grid"></div>
      </div>

      <!-- Input Area -->
      <div class="chat-input-area">
        <div class="reply-bar" id="reply-bar">
          <div class="reply-bar-content">
            <div class="reply-bar-name" id="reply-name">User</div>
            <div id="reply-preview-text" style="font-size:0.82rem;color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px;">Message</div>
          </div>
          <button class="reply-cancel" id="cancel-reply">âœ•</button>
        </div>
        <div class="input-row">
          <div class="input-menu-container">
            <button class="menu-toggle-btn" id="menu-toggle-btn" title="More options">ï¼‹</button>
            <div class="input-popover" id="input-popover">
              <button class="popover-item" id="attach-menu-btn">ğŸ“ Document</button>
              <button class="popover-item" id="gif-menu-btn">ğŸ­ GIF</button>
              <button class="popover-item" id="emoji-menu-btn">ğŸ˜Š Emoji</button>
            </div>
          </div>
          <input type="file" id="file-input" accept="image/*,audio/*,video/*,application/pdf,text/plain" />
          <div class="msg-input-wrap">
            <textarea class="msg-input" id="msg-input" placeholder="Type a message..." rows="1" maxlength="2000"></textarea>
          </div>
          <button class="send-btn" id="send-btn" title="Send">â¤</button>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- MODALS -->

<!-- Search Users Modal -->
<div class="modal-overlay" id="search-modal">
  <div class="modal">
    <div class="modal-header">
      <h3>ğŸ” Find Users</h3>
      <button class="modal-close" onclick="closeModal('search-modal')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="text" class="search-modal-input" id="user-search-input" placeholder="Search by username, name, or ID..." />
      <div class="search-results" id="search-results">
        <p style="text-align:center;color:var(--text-muted);font-size:0.9rem;">Type to search users...</p>
      </div>
    </div>
  </div>
</div>

<!-- Profile View Modal -->
<div class="modal-overlay" id="profile-view-modal">
  <div class="modal">
    <div class="modal-header">
      <h3>ğŸ‘¤ Profile</h3>
      <button class="modal-close" onclick="closeModal('profile-view-modal')">âœ•</button>
    </div>
    <div class="modal-body" id="profile-view-body" style="text-align:center">
      <!-- Populated dynamically -->
    </div>
  </div>
</div>

<!-- Own Profile Edit Modal -->
<div class="modal-overlay" id="own-profile-modal">
  <div class="modal">
    <div class="modal-header">
      <h3>âœï¸ Edit Profile</h3>
      <button class="modal-close" onclick="closeModal('own-profile-modal')">âœ•</button>
    </div>
    <div class="modal-body">
      <form class="profile-form" id="profile-form">
        <div style="text-align:center;margin-bottom:1.5rem;">
          <div class="profile-modal-avatar" id="edit-avatar-preview"></div>
        </div>
        <div class="form-group">
          <label>Display Name</label>
          <input type="text" id="edit-displayName" maxlength="50" required />
        </div>
        <div class="form-group">
          <label>Avatar URL</label>
          <input type="url" id="edit-avatar" placeholder="https://..." />
        </div>
        <div class="form-group">
          <label>Bio</label>
          <textarea id="edit-bio" maxlength="200" placeholder="Tell something about yourself..."></textarea>
        </div>
        <div class="form-group">
          <label>Status</label>
          <input type="text" id="edit-status" maxlength="100" />
        </div>
        <div class="form-group" style="display:flex;align-items:center;justify-content:space-between;">
          <label style="margin-bottom:0">ğŸ”” Notification Sound</label>
          <label style="position:relative;display:inline-block;width:44px;height:24px;cursor:pointer">
            <input type="checkbox" id="edit-notif" style="opacity:0;width:0;height:0;">
            <span id="toggle-slider" style="position:absolute;inset:0;background:#cbd5e1;border-radius:24px;transition:background 0.2s;"></span>
            <span id="toggle-knob" style="position:absolute;left:2px;top:2px;width:20px;height:20px;background:white;border-radius:50%;transition:left 0.2s;box-shadow:0 1px 3px rgba(0,0,0,0.3);"></span>
          </label>
        </div>
        <button type="submit" class="btn-save">ğŸ’¾ Save Changes</button>
      </form>
    </div>
  </div>
</div>

<!-- Image Preview Modal -->
<div class="modal-overlay" id="image-modal">
  <div class="modal" style="max-width:90vw;background:transparent;box-shadow:none;">
    <div style="text-align:right;margin-bottom:0.5rem;">
      <button onclick="closeModal('image-modal')" style="background:rgba(255,255,255,0.2);border:none;border-radius:50%;width:36px;height:36px;cursor:pointer;color:white;font-size:1.1rem;">âœ•</button>
    </div>
    <img id="preview-img" src="" alt="Preview" style="max-width:100%;max-height:80vh;border-radius:12px;object-fit:contain;" />
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/chat.js"></script>
</body>
</html>
